# Kafka 개념 전체 정리 요약

## 개념 정리
- 토픽의 파티션별로 브로커 리더 및 팔로워가 존재한다
    - Replication Factor -> 복제할 브로커 개수
    - Min In Sync Replicas -> 최소 복제될 브로커 개수
        - ex) min.in.sync.replicas: 2
            - 메시지 쓰기 성공을 위해서 2개 레플리카에 동기화가 되어야 한다.

보통 위 설정을 잡을 떄는 표준은 아래와 같다
```text
# 토픽 설정
replication.factor: 3
min.insync.replicas: 2

# producer 설정
acks: all
```

```text
토픽 이름: log-events
Partitions: 4
Replication Factor: 3

파티션 0:
  브로커0 (kafka00) ← 리더 ⭐
  브로커1 (kafka01) ← 팔로워
  브로커2 (kafka02) ← 팔로워

파티션 1:
  브로커1 (kafka01) ← 리더 ⭐
  브로커2 (kafka02) ← 팔로워
  브로커0 (kafka00) ← 팔로워

파티션 2:
  브로커2 (kafka02) ← 리더 ⭐
  브로커0 (kafka00) ← 팔로워
  브로커1 (kafka01) ← 팔로워

파티션 3:
  브로커0 (kafka00) ← 리더 ⭐
  브로커1 (kafka01) ← 팔로워
  브로커2 (kafka02) ← 팔로워
```


- InSync 설정에 의해서 메시지 유실될 확률이 적어지기는 하지만, 동기화로 인해 프로듀서와 컨슈머를 느리게 만들 수 있다
    - InSync 레플리카가 줄어들면 파티션의 실질적인 복제 팩터가 줄어들면서 중단 시간이 길어지거나 데이터가 유실될 위험성은 높아진다.























